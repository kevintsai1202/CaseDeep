{
	"info": {
		"_postman_id": "p1-admin-certification-controller",
		"name": "P1-AdminCertification-Controller",
		"description": "管理員認證管理控制器測試集合 - 包含認證審核、狀態更新等功能的完整測試場景",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json",
		"_exporter_id": "case-mgr-api-testing"
	},
	"item": [
		{
			"name": "認證查詢管理",
			"item": [
				{
					"name": "取得認證列表 - 成功",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"// 設定測試環境變數",
									"pm.environment.set('test_page', '0');",
									"pm.environment.set('test_size', '10');",
									"pm.environment.set('test_sort', 'ceNo,desc');"
								],
								"type": "text/javascript"
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"// 基本回應驗證",
									"pm.test('Status code is 200', function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test('Response has correct content type', function () {",
									"    pm.expect(pm.response.headers.get('Content-Type')).to.include('application/json');",
									"});",
									"",
									"// 回應結構驗證",
									"pm.test('Response has pagination structure', function () {",
									"    const responseJson = pm.response.json();",
									"    pm.expect(responseJson).to.have.property('content');",
									"    pm.expect(responseJson).to.have.property('pageable');",
									"    pm.expect(responseJson).to.have.property('totalElements');",
									"    pm.expect(responseJson).to.have.property('totalPages');",
									"    pm.expect(responseJson).to.have.property('size');",
									"    pm.expect(responseJson).to.have.property('number');",
									"});",
									"",
									"// 認證資料結構驗證",
									"pm.test('Certification items have correct structure', function () {",
									"    const responseJson = pm.response.json();",
									"    if (responseJson.content && responseJson.content.length > 0) {",
									"        const certification = responseJson.content[0];",
									"        pm.expect(certification).to.have.property('ceNoBase62');",
									"        pm.expect(certification).to.have.property('status');",
									"        pm.expect(certification).to.have.property('identities');",
									"        pm.expect(certification).to.have.property('deals');",
									"        pm.expect(certification).to.have.property('applicant');",
									"        ",
									"        // 儲存測試用的認證ID",
									"        if (certification.ceNoBase62) {",
									"            pm.environment.set('test_certification_id', certification.ceNoBase62);",
									"        }",
									"    }",
									"});",
									"",
									"// CEStatus枚舉值驗證",
									"pm.test('Status values are valid CEStatus enum', function () {",
									"    const responseJson = pm.response.json();",
									"    const validStatuses = ['Create', 'Submit', 'Process', 'Approve', 'Reject', 'Paid', 'Complete'];",
									"    ",
									"    if (responseJson.content && responseJson.content.length > 0) {",
									"        responseJson.content.forEach(function(certification) {",
									"            if (certification.status) {",
									"                pm.expect(validStatuses).to.include(certification.status);",
									"            }",
									"        });",
									"    }",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{access_token}}",
								"type": "text"
							},
							{
								"key": "Content-Type",
								"value": "application/json",
								"type": "text"
							}
						],
						"url": {
							"raw": "{{base_url}}/api/admin/certifications?page={{test_page}}&size={{test_size}}&sort={{test_sort}}",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"admin",
								"certifications"
							],
							"query": [
								{
									"key": "page",
									"value": "{{test_page}}"
								},
								{
									"key": "size",
									"value": "{{test_size}}"
								},
								{
									"key": "sort",
									"value": "{{test_sort}}"
								}
							]
						}
					}
				},
				{
					"name": "取得認證列表 - 分頁測試",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"// 設定分頁測試參數",
									"pm.environment.set('test_page', '1');",
									"pm.environment.set('test_size', '5');",
									"pm.environment.set('test_sort', 'status,asc');"
								],
								"type": "text/javascript"
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Status code is 200', function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test('Pagination parameters are correct', function () {",
									"    const responseJson = pm.response.json();",
									"    pm.expect(responseJson.number).to.eql(1);",
									"    pm.expect(responseJson.size).to.eql(5);",
									"});",
									"",
									"pm.test('Content array size is within limit', function () {",
									"    const responseJson = pm.response.json();",
									"    pm.expect(responseJson.content.length).to.be.at.most(5);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{access_token}}",
								"type": "text"
							},
							{
								"key": "Content-Type",
								"value": "application/json",
								"type": "text"
							}
						],
						"url": {
							"raw": "{{base_url}}/api/admin/certifications?page={{test_page}}&size={{test_size}}&sort={{test_sort}}",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"admin",
								"certifications"
							],
							"query": [
								{
									"key": "page",
									"value": "{{test_page}}"
								},
								{
									"key": "size",
									"value": "{{test_size}}"
								},
								{
									"key": "sort",
									"value": "{{test_sort}}"
								}
							]
						}
					}
				},
				{
					"name": "取得認證列表 - 無分頁參數",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Status code is 200', function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test('Default pagination is applied', function () {",
									"    const responseJson = pm.response.json();",
									"    pm.expect(responseJson).to.have.property('pageable');",
									"    pm.expect(responseJson).to.have.property('content');",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{access_token}}",
								"type": "text"
							},
							{
								"key": "Content-Type",
								"value": "application/json",
								"type": "text"
							}
						],
						"url": {
							"raw": "{{base_url}}/api/admin/certifications",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"admin",
								"certifications"
							]
						}
					}
				}
			]
		},
		{
			"name": "認證狀態更新管理",
			"item": [
				{
					"name": "更新認證狀態 - 審核通過",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"// 確保有測試用的認證ID",
									"if (!pm.environment.get('test_certification_id')) {",
									"    pm.environment.set('test_certification_id', '1');",
									"}"
								],
								"type": "text/javascript"
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Status code is 200', function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test('Response has correct content type', function () {",
									"    pm.expect(pm.response.headers.get('Content-Type')).to.include('application/json');",
									"});",
									"",
									"pm.test('Updated certification has correct structure', function () {",
									"    const responseJson = pm.response.json();",
									"    pm.expect(responseJson).to.have.property('ceNoBase62');",
									"    pm.expect(responseJson).to.have.property('status');",
									"    pm.expect(responseJson).to.have.property('identities');",
									"    pm.expect(responseJson).to.have.property('deals');",
									"});",
									"",
									"pm.test('Status is updated to Approve', function () {",
									"    const responseJson = pm.response.json();",
									"    pm.expect(responseJson.status).to.eql('Approve');",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "PUT",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{access_token}}",
								"type": "text"
							},
							{
								"key": "Content-Type",
								"value": "application/json",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"newStatus\": \"Approve\",\n    \"reviewComment\": \"認證資料完整，審核通過\",\n    \"score\": 95.0\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/admin/certifications/{{test_certification_id}}",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"admin",
								"certifications",
								"{{test_certification_id}}"
							]
						}
					}
				},
				{
					"name": "更新認證狀態 - 審核拒絕",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Status code is 200', function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test('Status is updated to Reject', function () {",
									"    const responseJson = pm.response.json();",
									"    pm.expect(responseJson.status).to.eql('Reject');",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "PUT",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{access_token}}",
								"type": "text"
							},
							{
								"key": "Content-Type",
								"value": "application/json",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"newStatus\": \"Reject\",\n    \"reviewComment\": \"認證資料不完整，請重新提交\",\n    \"score\": null\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/admin/certifications/{{test_certification_id}}",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"admin",
								"certifications",
								"{{test_certification_id}}"
							]
						}
					}
				},
				{
					"name": "更新認證狀態 - 處理中",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Status code is 200', function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test('Status is updated to Process', function () {",
									"    const responseJson = pm.response.json();",
									"    pm.expect(responseJson.status).to.eql('Process');",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "PUT",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{access_token}}",
								"type": "text"
							},
							{
								"key": "Content-Type",
								"value": "application/json",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"newStatus\": \"Process\",\n    \"reviewComment\": \"認證審核中，請耐心等待\",\n    \"score\": null\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/admin/certifications/{{test_certification_id}}",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"admin",
								"certifications",
								"{{test_certification_id}}"
							]
						}
					}
				},
				{
					"name": "更新認證狀態 - 完成",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Status code is 200', function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test('Status is updated to Complete', function () {",
									"    const responseJson = pm.response.json();",
									"    pm.expect(responseJson.status).to.eql('Complete');",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "PUT",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{access_token}}",
								"type": "text"
							},
							{
								"key": "Content-Type",
								"value": "application/json",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"newStatus\": \"Complete\",\n    \"reviewComment\": \"認證流程完成\",\n    \"score\": 90.0\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/admin/certifications/{{test_certification_id}}",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"admin",
								"certifications",
								"{{test_certification_id}}"
							]
						}
					}
				}
			]
		},
		{
			"name": "邊界條件測試",
			"item": [
				{
					"name": "更新不存在的認證",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Status code is 404', function () {",
									"    pm.response.to.have.status(404);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "PUT",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{access_token}}",
								"type": "text"
							},
							{
								"key": "Content-Type",
								"value": "application/json",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"newStatus\": \"Approve\",\n    \"reviewComment\": \"測試不存在的認證\",\n    \"score\": 85.0\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/admin/certifications/999999",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"admin",
								"certifications",
								"999999"
							]
						}
					}
				},
				{
					"name": "無效的狀態值",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Status code is 400', function () {",
									"    pm.response.to.have.status(400);",
									"});",
									"",
									"pm.test('Response contains error message', function () {",
									"    const responseJson = pm.response.json();",
									"    pm.expect(responseJson).to.have.property('error');",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "PUT",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{access_token}}",
								"type": "text"
							},
							{
								"key": "Content-Type",
								"value": "application/json",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"newStatus\": \"InvalidStatus\",\n    \"reviewComment\": \"測試無效狀態\",\n    \"score\": 85.0\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/admin/certifications/{{test_certification_id}}",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"admin",
								"certifications",
								"{{test_certification_id}}"
							]
						}
					}
				},
				{
					"name": "缺少必要欄位",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Status code is 400', function () {",
									"    pm.response.to.have.status(400);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "PUT",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{access_token}}",
								"type": "text"
							},
							{
								"key": "Content-Type",
								"value": "application/json",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"reviewComment\": \"缺少newStatus欄位\",\n    \"score\": 85.0\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/admin/certifications/{{test_certification_id}}",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"admin",
								"certifications",
								"{{test_certification_id}}"
							]
						}
					}
				},
				{
					"name": "分頁參數邊界測試",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Status code is 200', function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test('Large page size is handled correctly', function () {",
									"    const responseJson = pm.response.json();",
									"    pm.expect(responseJson).to.have.property('content');",
									"    pm.expect(responseJson.content.length).to.be.at.most(1000);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{access_token}}",
								"type": "text"
							},
							{
								"key": "Content-Type",
								"value": "application/json",
								"type": "text"
							}
						],
						"url": {
							"raw": "{{base_url}}/api/admin/certifications?page=0&size=1000",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"admin",
								"certifications"
							],
							"query": [
								{
									"key": "page",
									"value": "0"
								},
								{
									"key": "size",
									"value": "1000"
								}
							]
						}
					}
				}
			]
		},
		{
			"name": "安全性測試",
			"item": [
				{
					"name": "無認證Token測試",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Status code is 401', function () {",
									"    pm.response.to.have.status(401);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json",
								"type": "text"
							}
						],
						"url": {
							"raw": "{{base_url}}/api/admin/certifications",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"admin",
								"certifications"
							]
						}
					}
				},
				{
					"name": "無效Token測試",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Status code is 401', function () {",
									"    pm.response.to.have.status(401);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer invalid_token_here",
								"type": "text"
							},
							{
								"key": "Content-Type",
								"value": "application/json",
								"type": "text"
							}
						],
						"url": {
							"raw": "{{base_url}}/api/admin/certifications",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"admin",
								"certifications"
							]
						}
					}
				},
				{
					"name": "權限不足測試",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"// 使用一般用戶token（如果有的話）",
									"// 這裡假設有一個權限不足的token",
									"pm.environment.set('insufficient_token', 'eyJhbGciOiJIUzI1NiJ9.test_insufficient_permissions');"
								],
								"type": "text/javascript"
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Status code is 403', function () {",
									"    pm.response.to.have.status(403);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{insufficient_token}}",
								"type": "text"
							},
							{
								"key": "Content-Type",
								"value": "application/json",
								"type": "text"
							}
						],
						"url": {
							"raw": "{{base_url}}/api/admin/certifications",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"admin",
								"certifications"
							]
						}
					}
				}
			]
		},
		{
			"name": "清理測試資料",
			"item": [
				{
					"name": "清理環境變數",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"// 清理測試過程中設定的環境變數",
									"pm.environment.unset('test_certification_id');",
									"pm.environment.unset('test_page');",
									"pm.environment.unset('test_size');",
									"pm.environment.unset('test_sort');",
									"pm.environment.unset('insufficient_token');",
									"",
									"pm.test('Environment variables cleaned up', function () {",
									"    pm.expect(pm.environment.get('test_certification_id')).to.be.undefined;",
									"    pm.expect(pm.environment.get('test_page')).to.be.undefined;",
									"    pm.expect(pm.environment.get('test_size')).to.be.undefined;",
									"    pm.expect(pm.environment.get('test_sort')).to.be.undefined;",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/api/health",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"health"
							]
						}
					}
				}
			]
		}
	],
	"event": [
		{
			"listen": "prerequest",
			"script": {
				"id": "global-prerequest",
				"exec": [
					"// 全域前置腳本 - AdminCertificationController測試",
					"console.log('=== AdminCertificationController API測試開始 ===');",
					"",
					"// 檢查必要的環境變數",
					"const requiredVars = ['base_url', 'access_token'];",
					"const missingVars = requiredVars.filter(varName => !pm.environment.get(varName));",
					"",
					"if (missingVars.length > 0) {",
					"    console.error('缺少必要的環境變數:', missingVars.join(', '));",
					"    throw new Error(`請設定環境變數: ${missingVars.join(', ')}`);",
					"}",
					"",
					"// 設定通用請求標頭",
					"pm.request.headers.add({",
					"    key: 'Accept',",
					"    value: 'application/json'",
					"});",
					"",
					"// 記錄當前測試資訊",
					"console.log('當前請求:', pm.info.requestName);",
					"console.log('基礎URL:', pm.environment.get('base_url'));",
					"",
					"// 設定測試開始時間",
					"pm.environment.set('test_start_time', new Date().toISOString());"
				],
				"type": "text/javascript"
			}
		},
		{
			"listen": "test",
			"script": {
				"id": "global-test",
				"exec": [
					"// 全域測試腳本 - AdminCertificationController測試",
					"",
					"// 記錄回應時間",
					"const responseTime = pm.response.responseTime;",
					"console.log(`回應時間: ${responseTime}ms`);",
					"",
					"// 效能測試 - 回應時間應該在合理範圍內",
					"pm.test('Response time is acceptable', function () {",
					"    pm.expect(responseTime).to.be.below(5000); // 5秒內",
					"});",
					"",
					"// 基本安全標頭檢查",
					"pm.test('Security headers present', function () {",
					"    // 檢查是否有基本的安全標頭（根據實際API調整）",
					"    const headers = pm.response.headers;",
					"    // 這些測試可以根據實際的安全需求調整",
					"});",
					"",
					"// 記錄測試完成時間",
					"const testEndTime = new Date().toISOString();",
					"console.log('測試完成時間:', testEndTime);",
					"",
					"// 清理單次測試的臨時變數",
					"pm.environment.unset('temp_test_var');"
				],
				"type": "text/javascript"
			}
		}
	],
	"variable": [
		{
			"key": "controller_name",
			"value": "AdminCertificationController",
			"type": "string"
		},
		{
			"key": "test_description",
			"value": "管理員認證管理控制器測試 - 包含認證審核、狀態更新等功能",
			"type": "string"
		}
	]
}