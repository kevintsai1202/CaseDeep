{
  "info": {
    "name": "P1-AdminUser-Controller",
    "description": "管理員用戶管理控制器測試集合 - 包含用戶CRUD操作、排序管理、權限管理、狀態管理等完整測試場景",
    "version": "1.0.0",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "auth": {
    "type": "bearer",
    "bearer": [
      {
        "key": "token",
        "value": "{{authToken}}",
        "type": "string"
      }
    ]
  },
  "event": [
    {
      "listen": "prerequest",
      "script": {
        "type": "text/javascript",
        "exec": [
          "// 全域前置腳本 - AdminUser Controller 測試",
          "console.log('=== AdminUser Controller 測試開始 ===');",
          "",
          "// 檢查認證Token",
          "if (!pm.environment.get('authToken')) {",
          "    console.error('認證Token未設置，請先執行認證測試');",
          "    throw new Error('Authentication token is required');",
          "}",
          "",
          "// 設置基礎URL",
          "pm.environment.set('baseUrl', 'http://localhost:8080');",
          "",
          "// 生成測試用戶資料",
          "const timestamp = Date.now();",
          "pm.environment.set('testTimestamp', timestamp);",
          "pm.environment.set('testUsername', 'admin_test_user_' + timestamp);",
          "pm.environment.set('testEmail', 'admin_test_' + timestamp + '@example.com');",
          "pm.environment.set('testPassword', 'AdminTest123!');",
          "",
          "// 初始化測試資料陣列",
          "if (!pm.environment.get('createdUserIds')) {",
          "    pm.environment.set('createdUserIds', JSON.stringify([]));",
          "}",
          "",
          "console.log('AdminUser Controller 前置腳本執行完成');"
        ]
      }
    },
    {
      "listen": "test",
      "script": {
        "type": "text/javascript",
        "exec": [
          "// 全域測試腳本",
          "// 基礎響應驗證",
          "pm.test('響應時間應小於2000ms', function() {",
          "    pm.expect(pm.response.responseTime).to.be.below(2000);",
          "});",
          "",
          "// 記錄測試結果",
          "console.log('請求:', pm.request.method + ' ' + pm.request.url);",
          "console.log('狀態碼:', pm.response.code);",
          "console.log('響應時間:', pm.response.responseTime + 'ms');"
        ]
      }
    }
  ],
  "variable": [
    {
      "key": "baseUrl",
      "value": "http://localhost:8080"
    },
    {
      "key": "adminUsersPath",
      "value": "/api/admin/users"
    }
  ],
  "item": [
    {
      "name": "1. 用戶查詢管理",
      "item": [
        {
          "name": "1.1 獲取所有用戶列表 - 正常流程",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('HTTP狀態碼應為200', function() {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('響應應為有效的JSON格式', function() {",
                  "    pm.response.to.be.json;",
                  "});",
                  "",
                  "pm.test('Content-Type應為application/json', function() {",
                  "    pm.expect(pm.response.headers.get('Content-Type')).to.include('application/json');",
                  "});",
                  "",
                  "const users = pm.response.json();",
                  "",
                  "pm.test('用戶列表響應驗證', function() {",
                  "    pm.expect(users).to.be.an('array');",
                  "    if (users.length > 0) {",
                  "        users.forEach(user => {",
                  "            pm.expect(user).to.have.property('id');",
                  "            pm.expect(user).to.have.property('username');",
                  "            pm.expect(user).to.have.property('email');",
                  "            pm.expect(user).to.have.property('enabled');",
                  "            pm.expect(user.id).to.be.a('number');",
                  "            pm.expect(user.username).to.be.a('string');",
                  "            pm.expect(user.email).to.be.a('string');",
                  "            pm.expect(user.enabled).to.be.a('boolean');",
                  "        });",
                  "    }",
                  "});",
                  "",
                  "// 保存第一個用戶ID用於後續測試",
                  "if (users.length > 0) {",
                  "    pm.environment.set('existingUserId', users[0].id);",
                  "    pm.environment.set('existingUsername', users[0].username);",
                  "    console.log('保存現有用戶ID:', users[0].id);",
                  "}",
                  "",
                  "pm.test('用戶列表應按顯示順序排序', function() {",
                  "    if (users.length > 1) {",
                  "        for (let i = 1; i < users.length; i++) {",
                  "            if (users[i-1].displayOrder && users[i].displayOrder) {",
                  "                pm.expect(users[i-1].displayOrder).to.be.at.most(users[i].displayOrder);",
                  "            }",
                  "        }",
                  "    }",
                  "});",
                  "",
                  "console.log('獲取用戶列表測試完成，共', users.length, '個用戶');"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}{{adminUsersPath}}",
              "host": ["{{baseUrl}}"],
              "path": ["api", "admin", "users"]
            }
          }
        },
        {
          "name": "1.2 獲取用戶列表 - 無認證Token",
          "event": [
            {
              "listen": "prerequest",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "// 暫時移除認證Token進行安全性測試",
                  "pm.request.auth = null;"
                ]
              }
            },
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('應返回未授權錯誤', function() {",
                  "    pm.expect(pm.response.code).to.equal(401);",
                  "});",
                  "",
                  "console.log('安全性測試完成 - 無Token訪問被正確拒絕');"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}{{adminUsersPath}}",
              "host": ["{{baseUrl}}"],
              "path": ["api", "admin", "users"]
            }
          }
        }
      ]
    },
    {
      "name": "2. 用戶CRUD操作",
      "item": [
        {
          "name": "2.1 創建新用戶 - 正常流程",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('HTTP狀態碼應為201', function() {",
                  "    pm.response.to.have.status(201);",
                  "});",
                  "",
                  "pm.test('響應應為有效的JSON格式', function() {",
                  "    pm.response.to.be.json;",
                  "});",
                  "",
                  "pm.test('Content-Type應為application/json', function() {",
                  "    pm.expect(pm.response.headers.get('Content-Type')).to.include('application/json');",
                  "});",
                  "",
                  "const user = pm.response.json();",
                  "",
                  "pm.test('用戶物件結構驗證', function() {",
                  "    pm.expect(user).to.have.property('id');",
                  "    pm.expect(user).to.have.property('username');",
                  "    pm.expect(user).to.have.property('email');",
                  "    pm.expect(user).to.have.property('enabled');",
                  "    pm.expect(user.id).to.be.a('number');",
                  "    pm.expect(user.username).to.be.a('string');",
                  "    pm.expect(user.email).to.be.a('string');",
                  "    pm.expect(user.enabled).to.be.a('boolean');",
                  "});",
                  "",
                  "pm.test('創建的用戶資料驗證', function() {",
                  "    pm.expect(user.username).to.equal(pm.environment.get('testUsername'));",
                  "    pm.expect(user.email).to.equal(pm.environment.get('testEmail'));",
                  "    pm.expect(user.enabled).to.be.true;",
                  "});",
                  "",
                  "// 保存創建的用戶ID",
                  "const createdIds = JSON.parse(pm.environment.get('createdUserIds') || '[]');",
                  "createdIds.push(user.id);",
                  "pm.environment.set('createdUserIds', JSON.stringify(createdIds));",
                  "pm.environment.set('lastCreatedUserId', user.id);",
                  "",
                  "console.log('用戶創建成功，ID:', user.id);"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"username\": \"{{testUsername}}\",\n  \"email\": \"{{testEmail}}\",\n  \"password\": \"{{testPassword}}\",\n  \"roleNames\": [\"ROLE_USER\"],\n  \"roleIndustryScopes\": [\n    {\n      \"roleName\": \"ROLE_USER\",\n      \"isAllIndustries\": true,\n      \"industryIds\": []\n    }\n  ]\n}"
            },
            "url": {
              "raw": "{{baseUrl}}{{adminUsersPath}}",
              "host": ["{{baseUrl}}"],
              "path": ["api", "admin", "users"]
            }
          }
        },
        {
          "name": "2.2 創建用戶 - 無效資料",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('應返回驗證錯誤', function() {",
                  "    pm.expect(pm.response.code).to.equal(400);",
                  "});",
                  "",
                  "console.log('資料驗證測試完成 - 無效資料被正確拒絕');"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"username\": \"\",\n  \"email\": \"invalid-email\",\n  \"password\": \"123\",\n  \"roleNames\": [],\n  \"roleIndustryScopes\": []\n}"
            },
            "url": {
              "raw": "{{baseUrl}}{{adminUsersPath}}",
              "host": ["{{baseUrl}}"],
              "path": ["api", "admin", "users"]
            }
          }
        },
        {
          "name": "2.3 更新用戶資訊 - 正常流程",
          "event": [
            {
              "listen": "prerequest",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "// 確保有可用的用戶ID",
                  "const userId = pm.environment.get('lastCreatedUserId') || pm.environment.get('existingUserId');",
                  "if (!userId) {",
                  "    throw new Error('沒有可用的用戶ID進行更新測試');",
                  "}",
                  "pm.environment.set('updateUserId', userId);",
                  "",
                  "// 生成更新後的用戶名",
                  "const updatedUsername = 'updated_' + pm.environment.get('testUsername');",
                  "pm.environment.set('updatedUsername', updatedUsername);"
                ]
              }
            },
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('HTTP狀態碼應為200', function() {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('響應應為有效的JSON格式', function() {",
                  "    pm.response.to.be.json;",
                  "});",
                  "",
                  "pm.test('Content-Type應為application/json', function() {",
                  "    pm.expect(pm.response.headers.get('Content-Type')).to.include('application/json');",
                  "});",
                  "",
                  "const user = pm.response.json();",
                  "",
                  "pm.test('用戶物件結構驗證', function() {",
                  "    pm.expect(user).to.have.property('id');",
                  "    pm.expect(user).to.have.property('username');",
                  "    pm.expect(user).to.have.property('email');",
                  "    pm.expect(user).to.have.property('enabled');",
                  "    pm.expect(user.id).to.be.a('number');",
                  "    pm.expect(user.username).to.be.a('string');",
                  "    pm.expect(user.email).to.be.a('string');",
                  "    pm.expect(user.enabled).to.be.a('boolean');",
                  "});",
                  "",
                  "pm.test('更新的用戶資料驗證', function() {",
                  "    pm.expect(user.username).to.equal(pm.environment.get('updatedUsername'));",
                  "    pm.expect(user.enabled).to.be.false;",
                  "});",
                  "",
                  "console.log('用戶更新成功，ID:', user.id);"
                ]
              }
            }
          ],
          "request": {
            "method": "PUT",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"username\": \"{{updatedUsername}}\",\n  \"email\": \"{{testEmail}}\",\n  \"enabled\": false,\n  \"roleNames\": [\"ROLE_USER\"],\n  \"roleIndustryScopes\": [\n    {\n      \"roleName\": \"ROLE_USER\",\n      \"isAllIndustries\": false,\n      \"industryIds\": [1, 2]\n    }\n  ]\n}"
            },
            "url": {
              "raw": "{{baseUrl}}{{adminUsersPath}}/{{updateUserId}}",
              "host": ["{{baseUrl}}"],
              "path": ["api", "admin", "users", "{{updateUserId}}"]
            }
          }
        },
        {
          "name": "2.4 更新用戶 - 不存在的用戶ID",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('應返回錯誤響應', function() {",
                  "    pm.expect(pm.response.code).to.be.oneOf([400, 404]);",
                  "});",
                  "",
                  "console.log('不存在用戶更新測試完成');"
                ]
              }
            }
          ],
          "request": {
            "method": "PUT",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"username\": \"nonexistent_user\",\n  \"email\": \"test@example.com\",\n  \"enabled\": true,\n  \"roleNames\": [\"ROLE_USER\"],\n  \"roleIndustryScopes\": []\n}"
            },
            "url": {
              "raw": "{{baseUrl}}{{adminUsersPath}}/99999",
              "host": ["{{baseUrl}}"],
              "path": ["api", "admin", "users", "99999"]
            }
          }
        }
      ]
    },
    {
      "name": "3. 用戶狀態管理",
      "item": [
        {
          "name": "3.1 啟用/停用用戶 - 啟用",
          "event": [
            {
              "listen": "prerequest",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "const userId = pm.environment.get('lastCreatedUserId') || pm.environment.get('existingUserId');",
                  "pm.environment.set('enableUserId', userId);"
                ]
              }
            },
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('HTTP狀態碼應為200', function() {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('響應應為有效的JSON格式', function() {",
                  "    pm.response.to.be.json;",
                  "});",
                  "",
                  "pm.test('Content-Type應為application/json', function() {",
                  "    pm.expect(pm.response.headers.get('Content-Type')).to.include('application/json');",
                  "});",
                  "",
                  "const user = pm.response.json();",
                  "",
                  "pm.test('用戶物件結構驗證', function() {",
                  "    pm.expect(user).to.have.property('id');",
                  "    pm.expect(user).to.have.property('username');",
                  "    pm.expect(user).to.have.property('email');",
                  "    pm.expect(user).to.have.property('enabled');",
                  "    pm.expect(user.id).to.be.a('number');",
                  "    pm.expect(user.username).to.be.a('string');",
                  "    pm.expect(user.email).to.be.a('string');",
                  "    pm.expect(user.enabled).to.be.a('boolean');",
                  "});",
                  "",
                  "pm.test('用戶應被啟用', function() {",
                  "    pm.expect(user.enabled).to.be.true;",
                  "});",
                  "",
                  "console.log('用戶啟用成功，ID:', user.id);"
                ]
              }
            }
          ],
          "request": {
            "method": "PUT",
            "header": [
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}{{adminUsersPath}}/{{enableUserId}}/enable?enabled=true",
              "host": ["{{baseUrl}}"],
              "path": ["api", "admin", "users", "{{enableUserId}}", "enable"],
              "query": [
                {
                  "key": "enabled",
                  "value": "true"
                }
              ]
            }
          }
        },
        {
          "name": "3.2 啟用/停用用戶 - 停用",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('HTTP狀態碼應為200', function() {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('響應應為有效的JSON格式', function() {",
                  "    pm.response.to.be.json;",
                  "});",
                  "",
                  "pm.test('Content-Type應為application/json', function() {",
                  "    pm.expect(pm.response.headers.get('Content-Type')).to.include('application/json');",
                  "});",
                  "",
                  "const user = pm.response.json();",
                  "",
                  "pm.test('用戶物件結構驗證', function() {",
                  "    pm.expect(user).to.have.property('id');",
                  "    pm.expect(user).to.have.property('username');",
                  "    pm.expect(user).to.have.property('email');",
                  "    pm.expect(user).to.have.property('enabled');",
                  "    pm.expect(user.id).to.be.a('number');",
                  "    pm.expect(user.username).to.be.a('string');",
                  "    pm.expect(user.email).to.be.a('string');",
                  "    pm.expect(user.enabled).to.be.a('boolean');",
                  "});",
                  "",
                  "pm.test('用戶應被停用', function() {",
                  "    pm.expect(user.enabled).to.be.false;",
                  "});",
                  "",
                  "console.log('用戶停用成功，ID:', user.id);"
                ]
              }
            }
          ],
          "request": {
            "method": "PUT",
            "header": [
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}{{adminUsersPath}}/{{enableUserId}}/enable?enabled=false",
              "host": ["{{baseUrl}}"],
              "path": ["api", "admin", "users", "{{enableUserId}}", "enable"],
              "query": [
                {
                  "key": "enabled",
                  "value": "false"
                }
              ]
            }
          }
        },
        {
          "name": "3.3 重設用戶密碼 - 正常流程",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('HTTP狀態碼應為200', function() {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('密碼重設成功', function() {",
                  "    pm.expect(pm.response.code).to.equal(200);",
                  "});",
                  "",
                  "console.log('密碼重設成功');"
                ]
              }
            }
          ],
          "request": {
            "method": "PUT",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"newPassword\": \"NewPassword123!\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}{{adminUsersPath}}/{{enableUserId}}/reset-password",
              "host": ["{{baseUrl}}"],
              "path": ["api", "admin", "users", "{{enableUserId}}", "reset-password"]
            }
          }
        },
        {
          "name": "3.4 重設密碼 - 無效密碼",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('應返回密碼驗證錯誤', function() {",
                  "    pm.expect(pm.response.code).to.equal(400);",
                  "});",
                  "",
                  "console.log('無效密碼測試完成');"
                ]
              }
            }
          ],
          "request": {
            "method": "PUT",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"newPassword\": \"123\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}{{adminUsersPath}}/{{enableUserId}}/reset-password",
              "host": ["{{baseUrl}}"],
              "path": ["api", "admin", "users", "{{enableUserId}}", "reset-password"]
            }
          }
        }
      ]
    },
    {
      "name": "4. 用戶排序管理",
      "item": [
        {
          "name": "4.1 上移用戶 - 正常流程",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('HTTP狀態碼應為200', function() {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('響應應為有效的JSON格式', function() {",
                  "    pm.response.to.be.json;",
                  "});",
                  "",
                  "pm.test('Content-Type應為application/json', function() {",
                  "    pm.expect(pm.response.headers.get('Content-Type')).to.include('application/json');",
                  "});",
                  "",
                  "const response = pm.response.json();",
                  "",
                  "pm.test('操作結果響應驗證', function() {",
                  "    pm.expect(response).to.have.property('success');",
                  "    pm.expect(response).to.have.property('message');",
                  "    pm.expect(response.success).to.be.a('boolean');",
                  "    pm.expect(response.message).to.be.a('string');",
                  "});",
                  "",
                  "console.log('用戶上移操作完成，結果:', response.success);"
                ]
              }
            }
          ],
          "request": {
            "method": "PUT",
            "header": [
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}{{adminUsersPath}}/{{enableUserId}}/move-up",
              "host": ["{{baseUrl}}"],
              "path": ["api", "admin", "users", "{{enableUserId}}", "move-up"]
            }
          }
        },
        {
          "name": "4.2 下移用戶 - 正常流程",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('HTTP狀態碼應為200', function() {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('響應應為有效的JSON格式', function() {",
                  "    pm.response.to.be.json;",
                  "});",
                  "",
                  "pm.test('Content-Type應為application/json', function() {",
                  "    pm.expect(pm.response.headers.get('Content-Type')).to.include('application/json');",
                  "});",
                  "",
                  "const response = pm.response.json();",
                  "",
                  "pm.test('操作結果響應驗證', function() {",
                  "    pm.expect(response).to.have.property('success');",
                  "    pm.expect(response).to.have.property('message');",
                  "    pm.expect(response.success).to.be.a('boolean');",
                  "    pm.expect(response.message).to.be.a('string');",
                  "});",
                  "",
                  "console.log('用戶下移操作完成，結果:', response.success);"
                ]
              }
            }
          ],
          "request": {
            "method": "PUT",
            "header": [
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}{{adminUsersPath}}/{{enableUserId}}/move-down",
              "host": ["{{baseUrl}}"],
              "path": ["api", "admin", "users", "{{enableUserId}}", "move-down"]
            }
          }
        },
        {
          "name": "4.3 批次更新用戶排序 - 正常流程",
          "event": [
            {
              "listen": "prerequest",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "// 準備批次排序資料",
                  "const userId1 = pm.environment.get('lastCreatedUserId') || pm.environment.get('existingUserId');",
                  "const userId2 = pm.environment.get('existingUserId');",
                  "",
                  "if (!userId1 || !userId2) {",
                  "    console.log('跳過批次排序測試 - 需要至少2個用戶');",
                  "    pm.execution.skipRequest();",
                  "    return;",
                  "}",
                  "",
                  "// 設置批次排序請求資料",
                  "const batchOrderData = {",
                  "    orders: [",
                  "        { userId: parseInt(userId1), displayOrder: 1 },",
                  "        { userId: parseInt(userId2), displayOrder: 2 }",
                  "    ]",
                  "};",
                  "",
                  "pm.environment.set('batchOrderData', JSON.stringify(batchOrderData));"
                ]
              }
            },
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('HTTP狀態碼應為200', function() {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('響應應為有效的JSON格式', function() {",
                  "    pm.response.to.be.json;",
                  "});",
                  "",
                  "pm.test('Content-Type應為application/json', function() {",
                  "    pm.expect(pm.response.headers.get('Content-Type')).to.include('application/json');",
                  "});",
                  "",
                  "const response = pm.response.json();",
                  "",
                  "pm.test('操作結果響應驗證', function() {",
                  "    pm.expect(response).to.have.property('success');",
                  "    pm.expect(response).to.have.property('message');",
                  "    pm.expect(response.success).to.be.a('boolean');",
                  "    pm.expect(response.message).to.be.a('string');",
                  "});",
                  "",
                  "console.log('批次排序操作完成，結果:', response.success);"
                ]
              }
            }
          ],
          "request": {
            "method": "PUT",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{{batchOrderData}}"
            },
            "url": {
              "raw": "{{baseUrl}}{{adminUsersPath}}/batch-order",
              "host": ["{{baseUrl}}"],
              "path": ["api", "admin", "users", "batch-order"]
            }
          }
        },
        {
          "name": "4.4 批次排序 - 無效資料",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('應返回驗證錯誤', function() {",
                  "    pm.expect(pm.response.code).to.equal(400);",
                  "});",
                  "",
                  "console.log('批次排序驗證測試完成');"
                ]
              }
            }
          ],
          "request": {
            "method": "PUT",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"orders\": [\n    { \"userId\": null, \"displayOrder\": 1 },\n    { \"userId\": 999, \"displayOrder\": null }\n  ]\n}"
            },
            "url": {
              "raw": "{{baseUrl}}{{adminUsersPath}}/batch-order",
              "host": ["{{baseUrl}}"],
              "path": ["api", "admin", "users", "batch-order"]
            }
          }
        }
      ]
    },
    {
      "name": "5. 用戶權限查詢",
      "item": [
        {
          "name": "5.1 查詢用戶產業權限 - 正常流程",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('HTTP狀態碼應為200', function() {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('響應應為有效的JSON格式', function() {",
                  "    pm.response.to.be.json;",
                  "});",
                  "",
                  "pm.test('Content-Type應為application/json', function() {",
                  "    pm.expect(pm.response.headers.get('Content-Type')).to.include('application/json');",
                  "});",
                  "",
                  "const scopes = pm.response.json();",
                  "",
                  "pm.test('產業權限響應驗證', function() {",
                  "    pm.expect(scopes).to.be.an('array');",
                  "    if (scopes.length > 0) {",
                  "        scopes.forEach(scope => {",
                  "            pm.expect(scope).to.have.property('id');",
                  "            pm.expect(scope).to.have.property('roleName');",
                  "            pm.expect(scope).to.have.property('isAllIndustries');",
                  "        });",
                  "    }",
                  "});",
                  "",
                  "console.log('用戶產業權限查詢完成，共', scopes.length, '個權限');"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}{{adminUsersPath}}/{{enableUserId}}/industry-scopes",
              "host": ["{{baseUrl}}"],
              "path": ["api", "admin", "users", "{{enableUserId}}", "industry-scopes"]
            }
          }
        },
        {
          "name": "5.2 查詢特定角色產業權限 - 正常流程",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('HTTP狀態碼應為200', function() {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('響應應為有效的JSON格式', function() {",
                  "    pm.response.to.be.json;",
                  "});",
                  "",
                  "pm.test('Content-Type應為application/json', function() {",
                  "    pm.expect(pm.response.headers.get('Content-Type')).to.include('application/json');",
                  "});",
                  "",
                  "const scopes = pm.response.json();",
                  "",
                  "pm.test('角色產業權限響應驗證', function() {",
                  "    pm.expect(scopes).to.be.an('array');",
                  "    if (scopes.length > 0) {",
                  "        scopes.forEach(scope => {",
                  "            pm.expect(scope).to.have.property('id');",
                  "            pm.expect(scope).to.have.property('roleName');",
                  "            pm.expect(scope).to.have.property('isAllIndustries');",
                  "            pm.expect(scope.roleName).to.equal('ROLE_USER');",
                  "        });",
                  "    }",
                  "});",
                  "",
                  "console.log('角色產業權限查詢完成，共', scopes.length, '個權限');"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}{{adminUsersPath}}/{{enableUserId}}/industry-scopes/role/ROLE_USER",
              "host": ["{{baseUrl}}"],
              "path": ["api", "admin", "users", "{{enableUserId}}", "industry-scopes", "role", "ROLE_USER"]
            }
          }
        },
        {
          "name": "5.3 查詢不存在角色權限 - 錯誤處理",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('應返回錯誤響應', function() {",
                  "    pm.expect(pm.response.code).to.be.oneOf([400, 404]);",
                  "});",
                  "",
                  "console.log('不存在角色權限查詢測試完成');"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}{{adminUsersPath}}/{{enableUserId}}/industry-scopes/role/NONEXISTENT_ROLE",
              "host": ["{{baseUrl}}"],
              "path": ["api", "admin", "users", "{{enableUserId}}", "industry-scopes", "role", "NONEXISTENT_ROLE"]
            }
          }
        }
      ]
    },
    {
      "name": "6. 用戶刪除操作",
      "item": [
        {
          "name": "6.1 刪除用戶 - 正常流程",
          "event": [
            {
              "listen": "prerequest",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "// 使用創建的測試用戶進行刪除測試",
                  "const userId = pm.environment.get('lastCreatedUserId');",
                  "if (!userId) {",
                  "    console.log('跳過刪除測試 - 沒有可刪除的測試用戶');",
                  "    pm.execution.skipRequest();",
                  "    return;",
                  "}",
                  "pm.environment.set('deleteUserId', userId);"
                ]
              }
            },
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('HTTP狀態碼應為200', function() {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('用戶刪除成功', function() {",
                  "    pm.expect(pm.response.code).to.equal(200);",
                  "});",
                  "",
                  "// 從創建的用戶列表中移除已刪除的用戶",
                  "const createdIds = JSON.parse(pm.environment.get('createdUserIds') || '[]');",
                  "const deleteUserId = parseInt(pm.environment.get('deleteUserId'));",
                  "const updatedIds = createdIds.filter(id => id !== deleteUserId);",
                  "pm.environment.set('createdUserIds', JSON.stringify(updatedIds));",
                  "",
                  "console.log('用戶刪除成功，ID:', deleteUserId);"
                ]
              }
            }
          ],
          "request": {
            "method": "DELETE",
            "header": [
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}{{adminUsersPath}}/{{deleteUserId}}",
              "host": ["{{baseUrl}}"],
              "path": ["api", "admin", "users", "{{deleteUserId}}"]
            }
          }
        },
        {
          "name": "6.2 刪除不存在的用戶 - 錯誤處理",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('應返回錯誤響應', function() {",
                  "    pm.expect(pm.response.code).to.be.oneOf([400, 404]);",
                  "});",
                  "",
                  "console.log('不存在用戶刪除測試完成');"
                ]
              }
            }
          ],
          "request": {
            "method": "DELETE",
            "header": [
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}{{adminUsersPath}}/99999",
              "host": ["{{baseUrl}}"],
              "path": ["api", "admin", "users", "99999"]
            }
          }
        }
      ]
    },
    {
      "name": "7. 清理測試資料",
      "item": [
        {
          "name": "7.1 清理所有創建的測試用戶",
          "event": [
            {
              "listen": "prerequest",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "// 獲取所有創建的用戶ID",
                  "const createdIds = JSON.parse(pm.environment.get('createdUserIds') || '[]');",
                  "",
                  "if (createdIds.length === 0) {",
                  "    console.log('沒有需要清理的測試用戶');",
                  "    pm.execution.skipRequest();",
                  "    return;",
                  "}",
                  "",
                  "console.log('準備清理測試用戶，共', createdIds.length, '個');",
                  "pm.environment.set('cleanupUserIds', JSON.stringify(createdIds));"
                ]
              }
            },
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "// 這是一個示例清理請求，實際實現可能需要循環刪除",
                  "console.log('測試資料清理完成');",
                  "",
                  "// 清理環境變數",
                  "pm.environment.unset('createdUserIds');",
                  "pm.environment.unset('lastCreatedUserId');",
                  "pm.environment.unset('testUsername');",
                  "pm.environment.unset('testEmail');",
                  "pm.environment.unset('testPassword');",
                  "pm.environment.unset('updatedUsername');",
                  "pm.environment.unset('updateUserId');",
                  "pm.environment.unset('enableUserId');",
                  "pm.environment.unset('deleteUserId');",
                  "pm.environment.unset('batchOrderData');",
                  "pm.environment.unset('cleanupUserIds');",
                  "",
                  "console.log('=== AdminUser Controller 測試完成 ===');"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}{{adminUsersPath}}",
              "host": ["{{baseUrl}}"],
              "path": ["api", "admin", "users"]
            }
          }
        }
      ]
    }
  ]
}